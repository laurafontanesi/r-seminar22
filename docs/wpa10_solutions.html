<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Solutions to WPA10</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R seminar</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Syllabus</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-display"></span>
     
    WPAs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="wpa1.html">WPA 1</a>
    </li>
    <li>
      <a href="wpa2.html">WPA 2</a>
    </li>
    <li>
      <a href="wpa3.html">WPA 3</a>
    </li>
    <li>
      <a href="wpa4.html">WPA 4</a>
    </li>
    <li>
      <a href="wpa5.html">WPA 5</a>
    </li>
    <li>
      <a href="wpa6.html">WPA 6</a>
    </li>
    <li>
      <a href="wpa7.html">WPA 7</a>
    </li>
    <li>
      <a href="wpa8.html">WPA 8</a>
    </li>
    <li>
      <a href="wpa9.html">WPA 9</a>
    </li>
    <li>
      <a href="wpa10.html">WPA 10</a>
    </li>
    <li>
      <a href="final_project.html">Final Project</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-display-arrow-down"></span>
     
    Solutions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="wpa1_solutions.html">WPA 1</a>
    </li>
    <li>
      <a href="wpa2_solutions.html">WPA 2</a>
    </li>
    <li>
      <a href="wpa3_solutions.html">WPA 3</a>
    </li>
    <li>
      <a href="wpa4_solutions.html">WPA 4</a>
    </li>
    <li>
      <a href="wpa5_solutions.html">WPA 5</a>
    </li>
    <li>
      <a href="wpa6_solutions.html">WPA 6</a>
    </li>
    <li>
      <a href="wpa7_solutions.html">WPA 7</a>
    </li>
    <li>
      <a href="wpa8_solutions.html">WPA 8</a>
    </li>
    <li>
      <a href="wpa9_solutions.html">WPA 9</a>
    </li>
    <li>
      <a href="wpa10_solutions.html">WPA 10</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Solutions to WPA10</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#now-its-your-turn">Now it’s your turn</a></li>
</ul>
</div>

<pre class="r"><code>library(tidyverse)
library(readxl)
library(lme4)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre class="r"><code>data = read_excel(&#39;~/git/r-seminar/data/Bressoux Data AnPsycho.xls&#39;)

glimpse(data)</code></pre>
<pre><code>## Rows: 609
## Columns: 38
## $ NUMELEVE  &lt;dbl&gt; 701, 702, 703, 704, 705, 706, 707, 708, 709, 710, 711, 712, 713, 714, 716, 717, 718, 719, 720, 721, 7…
## $ FRAN4     &lt;dbl&gt; -1.03844718, 0.05081523, -1.32558075, 0.24899764, -1.32558075, 1.14062612, -0.91424034, -0.25480473, …
## $ CPBIS     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ CE1BIS    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ CE2BIS    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ CM1BIS    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ CM2BIS    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ MATH4     &lt;dbl&gt; -0.84660133, -0.90465749, -0.90465749, 0.06410083, -0.62877082, 0.69927881, -1.20330629, -1.81509449,…
## $ ECOLE2    &lt;dbl&gt; 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,…
## $ CLASSE2   &lt;dbl&gt; 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,…
## $ COURS2    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ RDBLT2    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ FRAN3     &lt;dbl&gt; 1.13978958, -0.25171360, 0.97295339, 1.13978958, -2.00298384, 1.59399505, -1.01594421, 1.38446085, -0…
## $ MATH3     &lt;dbl&gt; 0.36853256, -0.95115243, 0.67302730, 1.59547256, -1.10303698, 0.84497577, -1.10303698, -0.53838360, -…
## $ MOIS      &lt;dbl&gt; 10, 11, 10, 4, 11, 5, 12, 2, 8, 12, 12, 4, 12, 11, 7, 2, 8, 5, 11, 3, 8, 9, 11, 10, 8, 2, 12, 9, 2, 1…
## $ ANNEE     &lt;dbl&gt; 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 9…
## $ FRAT      &lt;dbl&gt; 3, 2, 2, 1, 2, 2, 2, 2, 3, 1, 2, 3, 2, 2, 2, 3, 1, 1, 2, 3, 1, 1, 1, 4, 1, 1, 1, 2, 2, 3, 1, 1, 1, 1,…
## $ PREEL     &lt;dbl&gt; 3, 3, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, …
## $ CSPP      &lt;dbl&gt; 6, 4, 1, 7, 4, 4, 6, 2, 2, 3, 5, 4, 3, 5, 6, 6, 3, 4, 2, 4, 2, 6, 3, 4, 5, 4, 3, 4, 3, 5, 4, 6, 5, 1,…
## $ CSPM      &lt;dbl&gt; 4, 7, 7, 6, 7, 4, 7, 7, 4, 2, 5, 5, 4, 4, 6, 6, 4, 4, 4, 8, 5, 5, 8, 5, 8, 7, 3, 4, 8, 6, 4, 3, 8, 5,…
## $ FILLE     &lt;dbl&gt; 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0,…
## $ ANCENS2   &lt;dbl&gt; 21, 21, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 28, 28, 28, 28, 28, 28, 28, 28, 13, 1…
## $ NBEL2     &lt;dbl&gt; 15, 15, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 22, 22, 22, 22, 22, 22, 22, 22, 23, 2…
## $ NBCOURS2  &lt;dbl&gt; 5, 5, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
## $ arti      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ sup       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0,…
## $ inter     &lt;dbl&gt; 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0,…
## $ empl      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0,…
## $ ouvr      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,…
## $ autr      &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ cmult     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ cmultnomb &lt;dbl&gt; 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ mfran3    &lt;dbl&gt; -0.009005236, -0.009005236, -0.009005236, -0.009005236, -0.009005236, -0.009005236, -0.009005236, -0.…
## $ mmath3    &lt;dbl&gt; 0.04217022, 0.04217022, 0.04217022, 0.04217022, 0.04217022, 0.04217022, 0.04217022, 0.04217022, 0.042…
## $ msup      &lt;dbl&gt; 0.08080808, 0.08080808, 0.08080808, 0.08080808, 0.08080808, 0.08080808, 0.08080808, 0.08080808, 0.080…
## $ mouvr     &lt;dbl&gt; 0.2727273, 0.2727273, 0.2727273, 0.2727273, 0.2727273, 0.2727273, 0.2727273, 0.2727273, 0.2727273, 0.…
## $ stdfran3  &lt;dbl&gt; 0.9908583, 0.9908583, 0.9908583, 0.9908583, 0.9908583, 0.9908583, 0.9908583, 0.9908583, 0.9908583, 0.…
## $ stdmath3  &lt;dbl&gt; 1.003498, 1.003498, 1.003498, 1.003498, 1.003498, 1.003498, 1.003498, 1.003498, 1.003498, 1.003498, 1…</code></pre>
<div id="now-its-your-turn" class="section level1">
<h1>Now it’s your turn</h1>
<ol style="list-style-type: decimal">
<li>Create a new variable in the dataset, called <code>improvement_math</code>, which is the difference between <code>MATH4</code> and <code>MATH3</code>; and <code>improvement_french</code> which is the difference between <code>FRAN4</code> and <code>FRAN3</code>.</li>
</ol>
<pre class="r"><code>data = mutate(data,
              improvement_math=(MATH4-MATH3),
              improvement_french=(FRAN4-FRAN3)
              )</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Run a multilevel model (separately for math and french), in which the improvement in math and french is predicted by at least 2 variables of your choice in the dataset, and that takes into account the school level. Run a random slope model, a random intercept model, and a random slope and intercept model.</li>
</ol>
<pre class="r"><code># Run a random intercept model
randintmodel = lmer(improvement_math ~ FRAT*FILLE + (1 | ECOLE2), data = data)

confint(randintmodel)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>##                   2.5 %    97.5 %
## .sig01       0.05678531 0.2578345
## .sigma       0.74594285 0.8357127
## (Intercept) -0.23360387 0.1389840
## FRAT        -0.06964690 0.1199475
## FILLE       -0.27800769 0.2004732
## FRAT:FILLE  -0.13623633 0.1243906</code></pre>
<pre class="r"><code># Run a random slope model
randslopemodel = lmer(improvement_math ~ FRAT*FILLE + (0 + FRAT*FILLE | ECOLE2), data = data)</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>summary(randslopemodel)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: improvement_math ~ FRAT * FILLE + (0 + FRAT * FILLE | ECOLE2)
##    Data: data
## 
## REML criterion at convergence: 1463.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.5806 -0.6509  0.0144  0.6231  2.9874 
## 
## Random effects:
##  Groups   Name       Variance  Std.Dev. Corr       
##  ECOLE2   FRAT       0.0064235 0.08015             
##           FILLE      0.0188100 0.13715   0.24      
##           FRAT:FILLE 0.0001447 0.01203   0.26 -0.87
##  Residual            0.6168941 0.78543             
## Number of obs: 609, groups:  ECOLE2, 16
## 
## Fixed effects:
##              Estimate Std. Error t value
## (Intercept) -0.048480   0.086606  -0.560
## FRAT         0.027640   0.053458   0.517
## FILLE       -0.050445   0.129298  -0.390
## FRAT:FILLE  -0.001028   0.067833  -0.015
## 
## Correlation of Fixed Effects:
##            (Intr) FRAT   FILLE 
## FRAT       -0.786              
## FILLE      -0.664  0.546       
## FRAT:FILLE  0.610 -0.641 -0.824
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code># Run a random intercept &amp; slope model
randintslopemodel = lmer(improvement_math ~ FRAT*FILLE + (FRAT*FILLE | ECOLE2), data = data)</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>summary(randintslopemodel)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: improvement_math ~ FRAT * FILLE + (FRAT * FILLE | ECOLE2)
##    Data: data
## 
## REML criterion at convergence: 1463
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.5995 -0.6537  0.0349  0.6154  2.9962 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr             
##  ECOLE2   (Intercept) 0.008807 0.09385                   
##           FRAT        0.009791 0.09895  -0.58            
##           FILLE       0.004390 0.06626   0.83 -0.03      
##           FRAT:FILLE  0.001287 0.03587   1.00 -0.52  0.87
##  Residual             0.614540 0.78393                   
## Number of obs: 609, groups:  ECOLE2, 16
## 
## Fixed effects:
##              Estimate Std. Error t value
## (Intercept) -0.040259   0.091026  -0.442
## FRAT         0.021253   0.056561   0.376
## FILLE       -0.063532   0.125206  -0.507
## FRAT:FILLE   0.006797   0.068990   0.099
## 
## Correlation of Fixed Effects:
##            (Intr) FRAT   FILLE 
## FRAT       -0.807              
## FILLE      -0.627  0.517       
## FRAT:FILLE  0.626 -0.657 -0.814
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code># Run a random intercept model
randintmodel = lmer(improvement_french ~ FRAT*FILLE + (1 | ECOLE2), data = data)

confint(randintmodel)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>##                   2.5 %     97.5 %
## .sig01       0.05201971 0.27449039
## .sigma       0.71702100 0.80413848
## (Intercept) -0.22447345 0.14253539
## FRAT        -0.13170548 0.05174996
## FILLE       -0.16515852 0.29629057
## FRAT:FILLE  -0.08529853 0.16596707</code></pre>
<pre class="r"><code># Run a random slope model
randslopemodel = lmer(improvement_french ~ FRAT*FILLE + (0 + FRAT*FILLE | ECOLE2), data = data)</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>summary(randslopemodel)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: improvement_french ~ FRAT * FILLE + (0 + FRAT * FILLE | ECOLE2)
##    Data: data
## 
## REML criterion at convergence: 1402
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.2966 -0.6298  0.0095  0.6142  3.1726 
## 
## Random effects:
##  Groups   Name       Variance  Std.Dev.  Corr       
##  ECOLE2   FRAT       9.758e-04 0.0312373            
##           FILLE      4.788e-02 0.2188170  1.00      
##           FRAT:FILLE 2.836e-07 0.0005326 -1.00 -1.00
##  Residual            5.724e-01 0.7565455            
## Number of obs: 602, groups:  ECOLE2, 16
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) -0.02134    0.08324  -0.256
## FRAT        -0.03795    0.04718  -0.805
## FILLE        0.02810    0.13201   0.213
## FRAT:FILLE   0.03113    0.06430   0.484
## 
## Correlation of Fixed Effects:
##            (Intr) FRAT   FILLE 
## FRAT       -0.846              
## FILLE      -0.628  0.609       
## FRAT:FILLE  0.617 -0.705 -0.759
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code># Run a random intercept &amp; slope model
randintslopemodel = lmer(improvement_french ~ FRAT*FILLE + (FRAT*FILLE | ECOLE2), data = data)</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>summary(randintslopemodel)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: improvement_french ~ FRAT * FILLE + (FRAT * FILLE | ECOLE2)
##    Data: data
## 
## REML criterion at convergence: 1400.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.2724 -0.6230  0.0062  0.5812  3.1828 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr             
##  ECOLE2   (Intercept) 0.030009 0.17323                   
##           FRAT        0.002267 0.04762  -1.00            
##           FILLE       0.008040 0.08967   0.20 -0.20      
##           FRAT:FILLE  0.007076 0.08412   1.00 -1.00  0.23
##  Residual             0.569065 0.75436                   
## Number of obs: 602, groups:  ECOLE2, 16
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) -0.04296    0.09508  -0.452
## FRAT        -0.03279    0.04800  -0.683
## FILLE        0.04875    0.12133   0.402
## FRAT:FILLE   0.02246    0.06842   0.328
## 
## Correlation of Fixed Effects:
##            (Intr) FRAT   FILLE 
## FRAT       -0.853              
## FILLE      -0.586  0.564       
## FRAT:FILLE  0.672 -0.744 -0.770
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see ?isSingular</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>(extra) Collapse the data across classrooms. Can you look at the effect of the number of student per classrrom on the improvements of math and french, taking into account the school level as well?</li>
</ol>
<pre class="r"><code>grouped = group_by(data, 
                   CLASSE2, )
collapsed = summarise(grouped, 
                      mean_improvement_math = mean(improvement_math, na.rm=TRUE),
                      mean_improvement_french = mean(improvement_french, na.rm=TRUE),
                      NBEL2 = mean(NBEL2),
                      ECOLE2 = mean(ECOLE2))
collapsed</code></pre>
<pre><code>## # A tibble: 32 x 5
##    CLASSE2 mean_improvement_math mean_improvement_french NBEL2 ECOLE2
##      &lt;dbl&gt;                 &lt;dbl&gt;                   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1       1                0.0992                  -0.131    27      1
##  2       2                0.350                   -0.126    15      2
##  3       3               -0.724                   -0.506    25      3
##  4       4               -0.294                   -0.508    26      3
##  5       5                0.0660                   0.421    26      3
##  6       6                0.560                    0.303    24      3
##  7       7               -0.303                   -0.100    22      4
##  8       8               -0.764                    0.936    23      5
##  9       9               -0.0604                  -0.133    26      5
## 10      10               -0.519                    0.153    25      5
## # … with 22 more rows</code></pre>
<pre class="r"><code># Run a random intercept &amp; slope model
randintslopemodel = lmer(mean_improvement_math ~ NBEL2 + (1 | ECOLE2), data = collapsed)</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>confint(randintslopemodel)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>## Warning in nextpar(mat, cc, i, delta, lowcut, upcut): Last two rows have identical or NA .zeta values: using minstep</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): non-monotonic profile for .sig01</code></pre>
<pre><code>## Warning in confint.thpr(pp, level = level, zeta = zeta): bad spline fit for .sig01: falling back to linear interpolation</code></pre>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm): collapsing to unique &#39;x&#39; values</code></pre>
<pre><code>##                   2.5 %     97.5 %
## .sig01       0.00000000 0.26159820
## .sigma       0.32853078 0.53801996
## (Intercept) -0.74659262 0.59586205
## NBEL2       -0.02933113 0.02995233</code></pre>
<pre class="r"><code># Run a random intercept &amp; slope model
randintslopemodel = lmer(mean_improvement_french ~ NBEL2 + (1 | ECOLE2), data = collapsed)</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>confint(randintslopemodel)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): non-monotonic profile for .sig01</code></pre>
<pre><code>## Warning in confint.thpr(pp, level = level, zeta = zeta): bad spline fit for .sig01: falling back to linear interpolation</code></pre>
<pre><code>##                   2.5 %     97.5 %
## .sig01       0.00000000 0.22222182
## .sigma       0.29533576 0.48365798
## (Intercept) -0.78892056 0.41789139
## NBEL2       -0.01919235 0.03410106</code></pre>
<p>There seem to be no effect of the number of students on the mean improvement.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
